<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Visual Block Editor (Lit)</title>
    <style>
      html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
      .root { display:flex; height:100%; width:100%; }
      .left { flex: 1; position:relative; }
      .right { width: 460px; border-left: 1px solid #e5e7eb; background:#fff; overflow:auto; padding:16px; }
      .note { font-size: 12px; color:#6b7280; line-height: 1.5; }
      code { background: #f3f4f6; padding: 2px 6px; border-radius: 4px; }
    </style>
  </head>
  <body>
    <div class="root">
      <div class="left">
        <!--
          Provider (data + UI state)
          - Click the floating button to load an id
        -->
        <visual-block-data id="data-provider" base-url="https://us-central1-lozzuck.cloudfunctions.net/blocks">
          <visual-block-editor></visual-block-editor>
        </visual-block-data>
      </div>
    </div>

    <!-- Test Lit component -->
    <test-lit-component></test-lit-component>

    <!-- Use the built IIFE bundle for broader compatibility -->
    <script src="../dist/iife/visual-block-editor.iife.js"></script>

    <script type="module">
      import { LitElement, html, css } from 'lit';

      class TestLitComponent extends LitElement {
        static styles = css`div { color: green; font-weight: bold; }`;
        render() { return html`<div>Lit is working!</div>`; }
      }
      customElements.define('test-lit-component', TestLitComponent);

      // Ensure the global register function is called for the IIFE bundle
      if (typeof window.VisualBlockEditor !== 'undefined' && typeof window.VisualBlockEditor.registerVisualBlockEditor === 'function') {
        window.VisualBlockEditor.registerVisualBlockEditor();
      }

      // Wait for the custom elements to be defined
      customElements.whenDefined('visual-block-data').then(() => {
        const dataProvider = document.getElementById('data-provider');

        // Example AI Client configuration
        dataProvider.aiClient = async (prompt, systemInstruction) => {
          console.log('AI Request:', { prompt, systemInstruction });
          await new Promise(resolve => setTimeout(resolve, 1000));
          return `This is a mock response for: "${prompt.substring(0, 30)}..."`;
        };

        console.log('AI Client configured.');
      });
    </script>
  </body>
</html>
